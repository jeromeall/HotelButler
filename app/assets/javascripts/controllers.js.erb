var hotelButlerCtrls = angular.module("hotelButlerCtrls", []);

hotelButlerCtrls.controller('stayIndexCtrl',['$scope','Stay', function($scope, Stay){
  //Get all the stays
  $scope.stays = Stay.query();

  //nghide function for new form creation if no stays exist
  $scope.existingStay = function(){
    if($scope.stays === []){
      return false;
    }else{
      return true;
    }
  };

}])

.controller('stayCreateCtrl',['$scope','$location','Stay', 'Hotel', 
  function($scope,$location, Stay, Hotel){

  //Query hotels for drop down select
  $scope.hotels = Hotel.query();

  //date options for datepicker
  $scope.dateOptions = {
    changeYear: true,
    changeMonth: true,
    yearRange: '2014:2020'
  };

  $scope.createStay = function() {
    //create the stay object to send to back-end
    console.log($scope.stay);
    var stay = new Stay($scope.stay);

    stay.$save(function() {
      // console.log(stay.id);
      // redirect to root path CHANGE LATER TO STAY
      $location.path("/stays/:" + stay.id);
    }, function(response) {
      //post response objects to the view
      $scope.errors = response.data.errors;
    });
  };
  
}])

.controller('conciergeCreateCtrl',['$scope','Concierge','$routeParams', '$location',
 function($scope, Concierge, $routeParams, $location){

   $scope.concierges = Concierge.query({stay_id: $routeParams.stay_id});
   $scope.dateOptions = {
    changeYear: true,
    changeMonth: true,
    yearRange: '2014:2020'
  };

  $scope.createConcierge = function() {

    var concierge = new Concierge({
      event_type: $scope.event_type,
      event_date: $scope.event_date,
      num_party: parseInt($scope.num_party),
      details: $scope.details
    });

    concierge.$save({
      stay_id: parseInt($routeParams.stay_id)
    },
    function() {
      // $location.path('/');
    }, function(response) {
      //post response objects to the view
      $scope.errors = response.data.errors;
    });
  };

}])

.controller('housekeepingCreateCtrl', ['$scope', 'Housekeeping', '$routeParams','$location', 
  function($scope, Housekeeping, $routeParams, $location){


    $scope.createHousekeeping = function(){

      var housekeeping = new Housekeeping({
        request: $scope.request
      });

      housekeeping.$save({
        stay_id: parseInt($routeParams.stay_id)
      },
      function() {
      // $location.path('/')
    }, function(response) {
      $scope.errors = response.data.errors;
    });
    };

  }])

.controller('roomserviceCreateCtrl', ['$scope', 'Roomservice','MenuItem', 
  '$routeParams', '$location','OrderDetail',
  function($scope, Roomservice, MenuItem, $routeParams, $location, OrderDetail) {
      //Query menu items
      $scope.menu_items = MenuItem.query({stay_id: $routeParams.stay_id});


      $scope.order = [];

      //condition for opening modal to provide item details
      $scope.openModal = true;
      
      //item object for modal
      $scope.currentItem = {
        name: "",
        price: "",
        description: "",
        menu_item_id: 0,
        roomservice_id: "",
        instructions: "",
      };

      $scope.numItems = [1,2,3,4,5,6,7,8,9,10];

      $scope.openOrderDetailsModal = function(index) {
        $scope.openModal = false;
        console.log($scope.currentItem);
        $scope.currentItem.name = $scope.menu_items[index].name;
        $scope.currentItem.price = $scope.menu_items[index].price;
        $scope.currentItem.description = $scope.menu_items[index].description;
        $scope.currentItem.menu_item_id = $scope.menu_items[index].id;
        console.log($scope.currentItem);
        return $scope.currentItem;
      };



      $scope.closeModal = function(){
        //clear currentItem attributes
        $scope.quantity='?';
        $scope.instructions="";
        $scope.openModal = true;
      };


      //make it so that it only adds a new item if it doesn't exist
      $scope.quantity="?";
      $scope.instructions= "";
      $scope.addToOrder = function(){
        $scope.openModal = true;
        var item = {
          menu_item_id: $scope.currentItem.menu_item_id,
          quantity: $scope.quantity,
          instructions: $scope.instructions,
          roomservice_id: null
        };
        console.log(item);
        $scope.order.push(item);
        //empty the fields after submit
        $scope.quantity='?';
        $scope.instructions="";
        console.log($scope.order);
      };

      $scope.createOrder = function() {
        var roomservice = new Roomservice();

        roomservice.$save(
          {
            stay_id: parseInt($routeParams.stay_id)
          }, function(orderResponse){
            $scope.createOrderDetails(orderResponse);
          }
          );
      };

      $scope.createOrderDetails = function(orderResponse){
        var orderDetail;
        console.log("in create OrderDetails", orderResponse);
        for(var item in $scope.order){
          orderDetail = new OrderDetail($scope.order[item]);
          console.log(orderDetail);
          orderDetail.roomservice_id = orderResponse.id;
          console.log(orderDetail);
          orderDetail.$save(
          {
            stay_id: parseInt($routeParams.stay_id),
            roomservice_id: parseInt(orderResponse.id)
          });
        }
      };






        }]);